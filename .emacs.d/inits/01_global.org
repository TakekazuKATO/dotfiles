* Welcome To Emacs!!
  最新版の emacs github mirror.
  - https://github.com/mirrors/emacs

  人気パッケージダウンロードランキング!!
  - http://melpa.org

* Functions
** フォルダを再帰的にロードパスに追加
   Special Thanks
   - http://e-arrows.sakura.ne.jp/2010/03/macros-in-emacs-el.html

#+begin_src emacs-lisp
;; @ load-path
;; for Emacs 23 under
(when (> emacs-major-version 23)
  (defvar user-emacs-directory "~/.emacs.d"))

;; load-path の追加関数
(defun add-to-load-path (&rest paths)
  (let (path)
    (dolist (path paths paths)
      (let ((default-directory (expand-file-name (concat user-emacs-directory path))))
	(add-to-list 'load-path default-directory)
	(if (fboundp 'normal-top-level-add-subdirs-to-load-path)
	    (normal-top-level-add-subdirs-to-load-path))))))
;; load-path に追加するフォルダ
;; 2 つ以上フォルダを指定する場合の引数 => (add-to-load-path "elisp" "xxx" "xxx")
(add-to-load-path "elisp" "inits" "el-get" "elpa" "local" "mylisp")
#+end_src
** Dired でカレントディレクトリを取得
  - [[http://d.hatena.ne.jp/syohex/20111026/1319606395][cde を改良 - Life is very short]]

#+begin_src emacs-lisp
;; .emacs 等設定ファイルに追加
(defun elscreen-current-directory ()
  (let* (current-dir
         (active-file-name
          (with-current-buffer
              (let* ((current-screen (car (elscreen-get-conf-list 'screen-history)))
                     (property (cadr (assoc current-screen
                                            (elscreen-get-conf-list 'screen-property)))))
                (marker-buffer (nth 2 property)))
            (progn
              (setq current-dir (expand-file-name (cadr (split-string (pwd)))))
              (buffer-file-name)))))
    (if active-file-name
        (file-name-directory active-file-name)
      current-dir)))

(defun non-elscreen-current-directory ()
  (let* (current-dir
         (current-buffer
          (nth 1 (assoc 'buffer-list
                        (nth 1 (nth 1 (current-frame-configuration))))))
         (active-file-name
          (with-current-buffer current-buffer
            (progn
              (setq current-dir (expand-file-name (cadr (split-string (pwd)))))
              (buffer-file-name)))))
    (if active-file-name
        (file-name-directory active-file-name)
      current-dir)))
#+end_src

* Macros
  Special Thanks
  - http://e-arrows.sakura.ne.jp/2010/03/macros-in-emacs-el.html

#+begin_src emacs-lisp
;;  add-hook を簡潔に
(defmacro add-hook-fn (name &rest body)
    `(add-hook ,name #'(lambda () ,@body)))

;; global-set-key も簡潔に
(defmacro global-set-key-fn (key args &rest body)
  `(global-set-key ,key (lambda ,args ,@body)))

;;  複数の要素をリストに追加
(defmacro append-to-list (to lst)
  `(setq ,to (append ,lst ,to)))
#+end_src

** use-package
   autoload/eval-after-load の記述を簡潔に書くための elisp.
   - https://github.com/jwiegley/use-package

   記述方法は以下の記事がとても詳しい. ここでは省略.
   - [[http://qiita.com/kai2nenobu/items/5dfae3767514584f5220][Emacs - use-package で可読性の高い init.el を書く - Qiita]]
   - [[http://rubikitch.com/2014/09/09/use-package/][emacs use-package.el : Emacs の世界的権威が行っている最先端ラクラク init.el 整理術]]

   参考になりすぎる init.el
   - https://github.com/kawabata/dotfiles/blob/master/.emacs.d/init.el

   遅延ロードが動いていないように見えるけど気のせいかな??

#+begin_src emacs-lisp
(package-initialize)

;; use-package が存在しないときはなにもしない
(unless (require 'use-package nil t)
  (defmacro use-package (&rest args)))

;; for debug 0.01 秒以上 load にかかったら report を出す.
;; (setq use-package-verbose t)
#+end_src

*** パッケージが存在しないとき
   もしパッケージが存在しないときは, 以下のようなメッセージが吐かれる.

   Could not load package hoge

   *Message* バッファを検索して, エラーがないかチェックする.

* General Settings
** inits, el-get 管理外の elisp のバイトコンパイル.
   - [[http://www.bookshelf.jp/soft/meadow_18.html][Meadow/Emacs memo: バイトコンパイル]]
   - [[http://www.gnu.org/software/emacs/manual/html_node/elisp/Compilation-Functions.html#Compilation-Functions][Compilation Functions - GNU Emacs Lisp Reference Manual]]

#+begin_src emacs-lisp
(byte-recompile-directory "~/.emacs.d/elisp/" 0)
(byte-recompile-directory "~/.emacs.d/mylisp/" 0)
#+end_src

** customize の出力先
#+begin_src emacs-lisp
(setq custom-file "~/.emacs.d/inits/02_custom.el")
(if (file-exists-p (expand-file-name "~/.emacs.d/inits/02_custom.el"))
    (load (expand-file-name custom-file) t nil nil))
#+end_src

** generic-x
   いろんなメジャーモード

#+begin_src emacs-lisp
(use-package generic-x)
#+end_src

** Variable binding depth exceeds max-specpdl-size error
   以下の行を追加.
   - [[http://d.hatena.ne.jp/a666666/20100221/1266695355][Variable binding depth exceeds max-specpdl-size エラー]]

#+begin_src emacs-lisp
(setq max-specpdl-size 6000)
#+end_src

** 自動閉じ括弧挿入

#+begin_src emacs-lisp
(electric-pair-mode 1)
#+end_src

** yes or no
  問い合わせを簡略化 A yes/no を y/n

#+begin_src emacs-lisp
(fset 'yes-or-no-p 'y-or-n-p)
#+end_src

* Key Bindings
** Global Keys
   よくわすれる, C や M の意味.
   - [[http://www.emacswiki.org/emacs/Emacs%e3%83%93%e3%82%ae%e3%83%8a%e3%83%bc#toc9][EmacsWiki: Emacs ビギナー]]

 #+begin_src emacs-lisp
(global-set-key (kbd "C-/")     'undo)
(global-set-key (kbd "C-S-i")   'indent-region)
(global-set-key (kbd "C-m")     'newline-and-indent)
 #+end_src

** 削除系
   | C-k | kill-line     |
   | M-d | kill-word     |
   | M-k | kill-sentence |

#+begin_src emacs-lisp
(global-set-key (kbd "C-h")     'backward-delete-char)
#+end_src

** key-guide
   キーバインドを教えてくれる.
  - https://github.com/kai2nenobu/guide-key
  - [[http://rubikitch.com/2014/08/30/guide-key/][もう迷子にならない! 今の Emacs は自動的に次のキー操作を教えてくれるゾ!!]]

#+begin_src emacs-lisp
(use-package guide-key
  :config
  (setq guide-key/popup-window-position 'bottom)
  (guide-key-mode 1)  ; Enable guide-key-mode
  (setq guide-key/guide-key-sequence '("C-x r" "C-x 4")))
#+end_src

** chord-key
   複数キー同時押しにキーバインド割り当て. 
   親指シフト的なバインドができる.

   #+begin_src emacs-lisp
(use-package key-chord
  :config
   (key-chord-mode 1)
   (setq key-chord-two-keys-delay 0.08)
   )
   #+end_src

** smartrep
   連続操作を素敵にするキーバインド設定を可能にする.
   - https://github.com/myuhe/smartrep.el
   - [[http://sheephead.homelinux.org/2011/12/19/6930/][連続操作を素敵にする smartrep.el 作った - sheephead]]
   - [[http://d.hatena.ne.jp/rubikitch/20140613/smartrep][Emacs - smartrep.el で repeat を活性化せよ -]]   

   multiple-cursor と一緒に利用するのが目的.

#+begin_src emacs-lisp
(use-package smartrep)
#+end_src

** goto どっかにとんでいく処理
   M-g の 仕様 (24.4)   goto-map は M-g にバインドされている.
   - TAB: move-to-column
   - p: previous-error
   - n: next-error
   - g: goto-line
   - c: goto-char

   参考:
   - [[http://g000001.cddddr.org/3628335601][#:g1: M-g を活用しよう]]

#+begin_src emacs-lisp
(define-key goto-map [?b] #'browse-url-at-point)
#+end_src

** bind-key
   use-package のサブモジュール.
   キー割り当ての設定関数 define-key を完全に置き換えます.
   - [[http://rubikitch.com/2014/09/10/bind-key/][emacs bind-key.el :define-key を直接書くのは時代遅れ!Emacs の重鎮が行っているスタイリッシュキー割り当て管理術!]]
      
   個人用に割り当てたキーを列挙できる ( M-x describe-personal-keybindings )

*** example
#+begin_src text
(global-set-key (kbd "C-c x") 'my-ctrl-c-x-command)
(bind-key "C-c x" 'my-ctrl-c-x-command)

(define-key some-other-mode-map (kbd "C-c x") 'my-ctrl-c-x-command)
(bind-key "C-c x" 'my-ctrl-c-x-command some-other-mode-map)
#+end_src

* Start Up
  起動時の設定

#+begin_src emacs-lisp
;; 起動時の scratch メッセージは表示しない
(setq initial-scratch-message nil)

;; 起動時の画面はいらない
(setq inhibit-startup-message t)

;; ウィンドウマネージャ環境での起動時間カイゼン
(modify-frame-parameters nil '((wait-for-wm . nil)))

;; byte-compile warning の無視
;; http://tsengf.blogspot.jp/2011/06/disable-byte-compile-warning-in-emacs.html
;; ignore byte-compile warnings 
(setq byte-compile-warnings '(not nresolved
                                  free-vars
                                  callargs
                                  redefine
                                  obsolete
                                  noruntime
                                  cl-functions
                                  interactive-only
                                  ))
#+end_src

** 時間計測
   これは普段は封印している. 時間を知りたくなったときに利用する.

*** 起動時間の把握
    M-x emacs-init-time という関数を実行すると, 起動にかかる時間がわかる.

*** esup をつかう
    esup を利用すると, 詳細な起動時間がわかる.
    - https://github.com/jschaf/esup

#+begin_src emacs-lisp
(use-package esup :disabled t)
#+end_src

   自分の環境だと, inits ディレクトリ配下がすべて結果が要約されてしまい,
   よくわからなかった.

*** initchart をつかう
    Emacs のスタートアップを視覚化する.
    - [[http://qiita.com/yuttie/items/0f38870817c11b2166bd][Emacs のスタートアップを視覚的に理解する - Qiita]]
    - https://github.com/yuttie/initchart

#+begin_src emacs-lisp
(use-package initchart 
  :disabled t
  :config
  (initchart-record-execution-time-of load file)
  (initchart-record-execution-time-of require feature))
#+end_src

** Emacs client
   server start for emacs-client
   - http://d.hatena.ne.jp/syohex/20101224/1293206906

 #+begin_src emacs-lisp
(use-package server
  :config
  (unless (server-running-p)
    (server-start)))
 #+end_src

  どうも, Elscreen が scratch を初期画面で開いてしまうようだ.

** Original Message
#+begin_src emacs-lisp
(defun my-startup-display-mode ()
  "Sets a fixed width (monospace) font in current buffer"
  (setq buffer-face-mode-face '(:height 1000))
  (buffer-face-mode))

(defun my-startup-display ()
  "Display startup message on buffer"
  (interactive)
  (let ((temp-buffer-show-function 'switch-to-buffer))
    (with-output-to-temp-buffer "*MyStartUpMessage*"  
;;      (princ "\n\nHello Emacs (^-^)/\nLet the Hacking Begin!\n")))
(princ "\n\nHello Emacs!!\nHappy Hacking (^-^)/\n")))
  (my-startup-display-mode)
  )

;; (defun kill-scratch ()
;;   (kill-buffer "*scratch*"))
;; (add-hook 'after-init-hook 'kill-scratch t)
(add-hook 'after-init-hook 'my-startup-display)
#+end_src

* TearDown
  終了時の設定.

#+begin_src emacs-lisp
;;; 終了時にオートセーブファイルを消す
(setq delete-auto-save-files t)
#+end_src

* netrc
  build-in のパスワード管理.
  パスワード自体は ~/.netrc に書き込む. 

#+begin_src emacs-lisp
(use-package netrc)
#+end_src

* Tips
** Emacs と X のクリップポードを共有
   - http://tubo028.hatenablog.jp/entry/2013/09/01/142238

   tramp で VM に乗り込むと, うまく動作しない.
   ssh の X forwarding の設定が必要?
   - http://superuser.com/questions/326871/using-clipboard-through-ssh-in-vim

   tramp するときだけ封印することにする. もっとうまい解決方法ないかな??
   
   Shift+Insert でも貼り付けできるので, とりあえずはこれで回避.
   
** BEEP  
   Ignore beep (for windows)
   
#+begin_src emacs-lisp
(setq visible-bell t)
(setq ring-bell-function 'ignore)
#+end_src
